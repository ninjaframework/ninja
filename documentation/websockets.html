<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.11.1 from src/site/markdown/documentation/websockets.md at 2023-12-07
 | Rendered using Apache Maven Fluido Skin 1.7
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20231207" />
    <meta http-equiv="Content-Language" content="en" />
    <title>Ninja &#x2013; WebSockets</title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-1.7.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />
    <script type="text/javascript" src="../js/apache-maven-fluido-1.7.min.js"></script>
<meta name="description"
                  content="Ninja is a full stack web framework for Java.
                    Rock solid, fast and super productive."/>
            <link rel="icon" type="image/png" href="favicon.png" />

            <link href='//fonts.googleapis.com/css?family=Titillium+Web' rel='stylesheet' type='text/css'/>
            <link href='//fonts.googleapis.com/css?family=Inconsolata' rel='stylesheet' type='text/css'/>
            <link href='//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css' rel='stylesheet' type='text/css'/>

            <script type="text/javascript">

                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-38154034-1']);
                _gaq.push(['_trackPageview']);

                (function() {
                var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                })();

            </script>
  </head>
  <body class="topBarDisabled">
    <a href="https://github.com/ninjaframework/ninja">
      <img style="position: absolute; top: 0; right: 0; border: 0; z-index: 10000;"
        src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png"
        alt="Fork me on GitHub">
    </a>
    <div class="container-fluid">
      <div id="banner">
        <div class="pull-left"><a href="../.." id="bannerLeft" title="Ninja web framework"><img src="../ninja_logo.png"  alt="Ninja web framework"/></a></div>
        <div class="pull-right"></div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
        <li id="publishDate" class="pull-right"><span class="divider">|</span> Last Published: 2023-12-07</li>
          <li id="projectVersion" class="pull-right">Version: 7.0.1-SNAPSHOT</li>
        </ul>
      </div>
      <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
    <ul class="nav nav-list">
      <li class="nav-header">Introduction</li>
    <li><a href="../introduction.html" title="The problem we solve"><span class="none"></span>The problem we solve</a></li>
    <li><a href="../high_level_overview.html" title="Ninja - high level overview"><span class="none"></span>Ninja - high level overview</a></li>
    <li><a href="../team.html" title="The team"><span class="none"></span>The team</a></li>
      <li class="nav-header">Commercial support</li>
    <li><a href="../commercial_support/philosophy.html" title="Philosophy"><span class="none"></span>Philosophy</a></li>
    <li><a href="../commercial_support/training.html" title="Training"><span class="none"></span>Training</a></li>
    <li><a href="../commercial_support/support_plans.html" title="Support plans"><span class="none"></span>Support plans</a></li>
    <li><a href="../commercial_support/agile_custom_development.html" title="Custom development"><span class="none"></span>Custom development</a></li>
      <li class="nav-header">Documentation</li>
    <li><a href="../documentation/getting_started/installing_ninja.html" title="Getting Started"><span class="icon-chevron-right"></span>Getting Started</a></li>
    <li><a href="../documentation/basic_concepts/basic_concepts.html" title="Basic concepts"><span class="icon-chevron-right"></span>Basic concepts</a></li>
    <li><a href="../documentation/configuration_and_modes.html" title="Configuration and modes"><span class="none"></span>Configuration and modes</a></li>
    <li><a href="../documentation/html_templating/getting_started.html" title="HTML templating"><span class="icon-chevron-right"></span>HTML templating</a></li>
    <li><a href="../documentation/working_with_json_jsonp.html" title="Working with JSON / JSONP"><span class="none"></span>Working with JSON / JSONP</a></li>
    <li><a href="../documentation/working_with_xml.html" title="Working with XML"><span class="none"></span>Working with XML</a></li>
      <li class="nav-header">Advanced topics</li>
    <li class="active"><a href="#"><span class="none"></span>Web Sockets</a></li>
    <li><a href="../documentation/validation.html" title="Validation"><span class="none"></span>Validation</a></li>
    <li><a href="../documentation/content_negotiation.html" title="Content negotiation"><span class="none"></span>Content negotiation</a></li>
    <li><a href="../documentation/uploading_files.html" title="Uploading files"><span class="none"></span>Uploading files</a></li>
    <li><a href="../documentation/scheduler.html" title="Scheduler"><span class="none"></span>Scheduler</a></li>
    <li><a href="../documentation/lifecycle.html" title="Lifecycle"><span class="none"></span>Lifecycle</a></li>
    <li><a href="../documentation/working_with_relational_dbs/jpa.html" title="Working with relational DBs"><span class="icon-chevron-right"></span>Working with relational DBs</a></li>
    <li><a href="../documentation/using_the_cache.html" title="Using the cache"><span class="none"></span>Using the cache</a></li>
    <li><a href="../documentation/internationalization.html" title="Internationalization"><span class="none"></span>Internationalization</a></li>
    <li><a href="../documentation/static_assets.html" title="Static assets"><span class="none"></span>Static assets</a></li>
    <li><a href="../documentation/sending_mail.html" title="Sending mail"><span class="none"></span>Sending mail</a></li>
    <li><a href="../documentation/logging.html" title="Logging"><span class="none"></span>Logging</a></li>
    <li><a href="../documentation/custom_routing.html" title="Custom routing"><span class="none"></span>Custom routing</a></li>
    <li><a href="../documentation/servlet_bridge.html" title="Servlet bridge"><span class="none"></span>Servlet bridge</a></li>
    <li><a href="../documentation/console.html" title="Console application"><span class="none"></span>Console application</a></li>
    <li><a href="../documentation/testing_your_application/getting_started.html" title="Testing"><span class="icon-chevron-right"></span>Testing</a></li>
    <li><a href="../documentation/debugging.html" title="Debugging"><span class="none"></span>Debugging</a></li>
    <li><a href="../documentation/security/getting_started.html" title="Security"><span class="none"></span>Security</a></li>
    <li><a href="../documentation/deployment/getting_started.html" title="Deployment"><span class="icon-chevron-right"></span>Deployment</a></li>
    <li><a href="../documentation/upgrade_guide.html" title="Upgrade guide"><span class="none"></span>Upgrade guide</a></li>
    <li><a href="../apidocs/index.html" title="API docs (JavaDoc)"><span class="none"></span>API docs (JavaDoc)</a></li>
      <li class="nav-header">Ninja Modules</li>
    <li><a href="../documentation/modules.html" title="Overview"><span class="none"></span>Overview</a></li>
      <li class="nav-header">Great community</li>
    <li><a href="https://twitter.com/ninjaframework" class="externalLink" title="@ninjaframework"><span class="none"></span>@ninjaframework</a></li>
    <li><a href="https://groups.google.com/d/forum/ninja-framework" class="externalLink" title="Mailing list"><span class="none"></span>Mailing list</a></li>
    <li><a href="https://github.com/ninjaframework/ninja" class="externalLink" title="Source code"><span class="none"></span>Source code</a></li>
    <li><a href="https://github.com/ninjaframework/ninja/issues" class="externalLink" title="Bug tracker"><span class="none"></span>Bug tracker</a></li>
    <li><a href="../security.html" title="Security issues"><span class="none"></span>Security issues</a></li>
      <li class="nav-header">For developers</li>
    <li><a href="../developer/changelog.html" title="Changelog"><span class="none"></span>Changelog</a></li>
    <li><a href="../developer/roadmap.html" title="Roadmap"><span class="none"></span>Roadmap</a></li>
    <li><a href="../developer/getting_started.html" title="How to contribute"><span class="none"></span>How to contribute</a></li>
</ul>
<form id="search-form" action="https://www.google.com/search" method="get" >
  <input value="https://www.ninjaframework.org" name="sitesearch" type="hidden"/>
  <input class="search-query" name="q" id="query" type="text" />
</form>
<script type="text/javascript">asyncJs( 'https://cse.google.com/brand?form=search-form' )</script>
          <hr />
          <div id="poweredBy">
            <div class="clear"></div>
            <div class="clear"></div>
    <div id="twitter">
    <a href="https://twitter.com/ninjaframework" class="twitter-follow-button" data-show-count="true" data-align="left" data-size="medium" data-show-screen-name="true" data-lang="en">Follow ninjaframework</a>
    <script type="text/javascript">!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
    </div>
            <div class="clear"></div>
            <div class="clear"></div>
<a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="../images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </div>
        <div id="bodyColumn"  class="span9" >
<h1>WebSockets</h1><section>
<h2><a name="Introduction"></a>Introduction</h2>
<p>The WebSocket Protocol enables two-way communication between a client and server.
The protocol consists of an opening handshake followed by basic message framing,
layered over TCP.  The goal of this technology is to provide a mechanism for
browser-based applications that need two-way communication with servers that does
not rely on opening multiple HTTP connections.</p>
<p>Ninja v6.2.0+ includes comprehensive support for WebSockets.  While designed to
work with the standard Java WebSocket standard (JSR-356), Ninja includes a number
of useful features beyond JSR-356 to make working with web sockets simpler.</p></section><section>
<h2><a name="Setup"></a>Setup</h2>
<p>Make sure you're running Ninja 6.2.0+. Ninja WebSockets will work out-of-the-box
in the Jetty standalone.  If running your Ninja application as a WAR.  Ninja
WebSockets will also work in any servlet container that supports JSR-356.
Ninja's implementation has been tested against Jetty 9.3.15+, Tomcat 7.0.81+,
and Wildfly 10+.</p>
<p>If running as a WAR in a servlet container, you'll need to swap your <code>GuiceFilter</code>
and use <code>ninja.servlet.NinjaServletFilter</code>. Or you can simply use Ninja's
automatic servlet configuration via its <code>ServletContainerInitializer</code> support
and omit even having a <code>web.xml</code>.</p></section><section>
<h2><a name="Add_a_WebSocket_route"></a>Add a WebSocket route</h2>
<p>All WebSocket endpoints will be configured in Ninja's router.  A new pseudo
HTTP method of <code>WS</code> indicates a route is for a WebSocket.  The controller
method that handles it will be able to accept/reject the handshake and negotiate
the protocol and extensions.  If you've ever used standard JSR-356 WebSockets
you'll appreciate how much easier Ninja's implementation is.</p>

<div class="source">
<pre class="prettyprint">
public class Routes implements ApplicationRoutes {
    @Override
    public void init(Router router) {

        router.WS().route(&quot;/echo&quot;).with(EchoWebSocket::handshake);
        router.WS().route(&quot;/chats/{id}&quot;).with(ChatWebSocket::handshake);

    }
}
</pre></div>

<p>Note that you'll be slightly limited with the URI you can use depending
on what's providing your underlying Ninja WebSocket support. If using standard
JSR-356 WebSockets (almost always the case), then you'll be able to use simple path
parameters such as <code>/chat/{id}</code>, but no regexes such as <code>/chat/{id: .*}</code>.</p>
<p>The declaring class of the handshake method you specify in your route will
become the WebSocket endpoint.  If you're using JSR-356 WebSockets then that
means your controller class will need to implement the <code>javax.websocket.Endpoint</code>
interface.  See the code below for a full example.</p></section><section>
<h2><a name="Web_socket_controller.2Fendpoint"></a>Web socket controller/endpoint</h2>
<p>You will want to make sure you do not mark your WebSocket class as a <code>@Singleton</code>.
Unless you know what you are doing, its better to create a new instance for each
WebSocket session that is created.</p>
<p>Your controller/endpoint will be created using Guice &#x2013; so the <code>@Inject</code> annotation
will be honored when instantiating your endpoint.</p></section><section>
<h2><a name="WebSocket_handshake"></a>WebSocket handshake</h2>
<p>One of the issues with Java's JSR-356 standard is that you have very little
control with the initial handshake request and little access to the HTTP headers
sent by the client.  This design flaw would make using Ninja's session or context
impossible.</p>
<p>Ninja fixes this design flaw with JSR-356 by using a two-step process to
complete the handshake.  When a client initiates a WebSocket request,
Ninja will detect the attempt, instantiate your WebSocket endpoint, and call
your <code>handshake</code> controller method (like any standard HTTP GET request).  You
can then accept/reject the handshake request or save any variables you'll want
to access later once the WebSocket session is established.</p>

<div class="source">
<pre class="prettyprint">
public class ChatWebSocket extends Endpoint implements MessageHandler.Whole&lt;String&gt; {
    
    public Result handshake(Context context, WebSocketHandshake handshake) {
        // negotiate the protocol (not always used by clients)
        handshake.selectProtocol(&quot;chat&quot;);

        // process handshake, save whatever you need, tell ninja to proceed
        // or return a failure result to reject the request
        return Results.webSocketContinue();
    }

    @Override
    public void onOpen(Session session, EndpointConfig config) {
        // jsr-356 stuff here...
    }

</pre></div>

<p>If your <code>handshake</code> method returns a status code of 101 then Ninja will
let the underlying HTTP container proceed with upgrading the connection to a
WebSocket.  If the upgrade is successful, Ninja guarantees that the instance
created for your handshake will be the same one that will receive the <code>onOpen</code>
event.</p></section><section>
<h2><a name="WebSocket_session"></a>WebSocket session</h2>
<p>Once the handshake completes and a WebSocket session is established, you will
then handle processing like any other JSR-356 implementation.  There are any
number of resources on the Internet for examples.</p></section>
        </div>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>Copyright &copy;2023
<a href="https://www.ninjaframework.org">ninjaframework</a>.
All rights reserved.</p>
        </div>
      </div>
    </footer>
  </body>
</html>
