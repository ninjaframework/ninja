<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.8.1 from src/site/markdown/documentation/basic_concepts/filters.md at 2019-05-05
 | Rendered using Apache Maven Fluido Skin 1.7
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20190505" />
    <meta http-equiv="Content-Language" content="en" />
    <title>Ninja &#x2013; Filtering</title>
    <link rel="stylesheet" href="../../css/apache-maven-fluido-1.7.min.css" />
    <link rel="stylesheet" href="../../css/site.css" />
    <link rel="stylesheet" href="../../css/print.css" media="print" />
    <script type="text/javascript" src="../../js/apache-maven-fluido-1.7.min.js"></script>
<meta name="description"
                  content="Ninja is a full stack web framework for Java.
                    Rock solid, fast and super productive."/>
            <link rel="icon" type="image/png" href="favicon.png" />

            <link href='//fonts.googleapis.com/css?family=Titillium+Web' rel='stylesheet' type='text/css'/>
            <link href='//fonts.googleapis.com/css?family=Inconsolata' rel='stylesheet' type='text/css'/>
            <link href='//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css' rel='stylesheet' type='text/css'/>

            <script type="text/javascript">

                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-38154034-1']);
                _gaq.push(['_trackPageview']);

                (function() {
                var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                })();

            </script>
  </head>
  <body class="topBarDisabled">
    <a href="https://github.com/ninjaframework/ninja">
      <img style="position: absolute; top: 0; right: 0; border: 0; z-index: 10000;"
        src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png"
        alt="Fork me on GitHub">
    </a>
    <div class="container-fluid">
      <div id="banner">
        <div class="pull-left"><a href="../../.." id="bannerLeft" title="Ninja web framework"><img src="../../ninja_logo.png"  alt="Ninja web framework"/></a></div>
        <div class="pull-right"></div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
        <li id="publishDate" class="pull-right"><span class="divider">|</span> Last Published: 2019-05-05</li>
          <li id="projectVersion" class="pull-right">Version: 6.5.0</li>
        </ul>
      </div>
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
    <ul class="nav nav-list">
      <li class="nav-header">Introduction</li>
    <li><a href="../../introduction.html" title="The problem we solve"><span class="none"></span>The problem we solve</a></li>
    <li><a href="../../high_level_overview.html" title="Ninja - high level overview"><span class="none"></span>Ninja - high level overview</a></li>
    <li><a href="../../team.html" title="The team"><span class="none"></span>The team</a></li>
      <li class="nav-header">Commercial support</li>
    <li><a href="../../commercial_support/philosophy.html" title="Philosophy"><span class="none"></span>Philosophy</a></li>
    <li><a href="../../commercial_support/training.html" title="Training"><span class="none"></span>Training</a></li>
    <li><a href="../../commercial_support/support_plans.html" title="Support plans"><span class="none"></span>Support plans</a></li>
    <li><a href="../../commercial_support/agile_custom_development.html" title="Custom development"><span class="none"></span>Custom development</a></li>
      <li class="nav-header">Documentation</li>
    <li><a href="../../documentation/getting_started/installing_ninja.html" title="Getting Started"><span class="icon-chevron-right"></span>Getting Started</a></li>
    <li><a href="../../documentation/basic_concepts/basic_concepts.html" title="Basic concepts"><span class="icon-chevron-down"></span>Basic concepts</a>
    <ul class="nav nav-list">
    <li><a href="../../documentation/basic_concepts/super_dev_mode.html" title="SuperDevMode"><span class="none"></span>SuperDevMode</a></li>
    <li><a href="../../documentation/basic_concepts/routing.html" title="Routing"><span class="none"></span>Routing</a></li>
    <li><a href="../../documentation/basic_concepts/controllers.html" title="Controllers"><span class="none"></span>Controllers</a></li>
    <li class="active"><a href="#"><span class="none"></span>Filters</a></li>
    <li><a href="../../documentation/basic_concepts/argument_extractors.html" title="Argument extractors"><span class="none"></span>Argument extractors</a></li>
    <li><a href="../../documentation/basic_concepts/dependency_injection.html" title="Dependency injection"><span class="none"></span>Dependency injection</a></li>
    <li><a href="../../documentation/basic_concepts/sessions.html" title="Sessions"><span class="none"></span>Sessions</a></li>
    <li><a href="../../documentation/basic_concepts/flash_scope.html" title="Flash scope"><span class="none"></span>Flash scope</a></li>
    <li><a href="../../documentation/basic_concepts/error_handling.html" title="Error handling"><span class="none"></span>Error handling</a></li>
    <li><a href="../../documentation/basic_concepts/metrics.html" title="Metrics"><span class="none"></span>Metrics</a></li>
    </ul>
</li>
    <li><a href="../../documentation/configuration_and_modes.html" title="Configuration and modes"><span class="none"></span>Configuration and modes</a></li>
    <li><a href="../../documentation/html_templating/getting_started.html" title="HTML templating"><span class="icon-chevron-right"></span>HTML templating</a></li>
    <li><a href="../../documentation/working_with_json_jsonp.html" title="Working with JSON / JSONP"><span class="none"></span>Working with JSON / JSONP</a></li>
    <li><a href="../../documentation/working_with_xml.html" title="Working with XML"><span class="none"></span>Working with XML</a></li>
      <li class="nav-header">Advanced topics</li>
    <li><a href="../../documentation/websockets.html" title="Web Sockets"><span class="none"></span>Web Sockets</a></li>
    <li><a href="../../documentation/validation.html" title="Validation"><span class="none"></span>Validation</a></li>
    <li><a href="../../documentation/content_negotiation.html" title="Content negotiation"><span class="none"></span>Content negotiation</a></li>
    <li><a href="../../documentation/uploading_files.html" title="Uploading files"><span class="none"></span>Uploading files</a></li>
    <li><a href="../../documentation/scheduler.html" title="Scheduler"><span class="none"></span>Scheduler</a></li>
    <li><a href="../../documentation/lifecycle.html" title="Lifecycle"><span class="none"></span>Lifecycle</a></li>
    <li><a href="../../documentation/working_with_relational_dbs/jpa.html" title="Working with relational DBs"><span class="icon-chevron-right"></span>Working with relational DBs</a></li>
    <li><a href="../../documentation/using_the_cache.html" title="Using the cache"><span class="none"></span>Using the cache</a></li>
    <li><a href="../../documentation/internationalization.html" title="Internationalization"><span class="none"></span>Internationalization</a></li>
    <li><a href="../../documentation/static_assets.html" title="Static assets"><span class="none"></span>Static assets</a></li>
    <li><a href="../../documentation/sending_mail.html" title="Sending mail"><span class="none"></span>Sending mail</a></li>
    <li><a href="../../documentation/logging.html" title="Logging"><span class="none"></span>Logging</a></li>
    <li><a href="../../documentation/custom_routing.html" title="Custom routing"><span class="none"></span>Custom routing</a></li>
    <li><a href="../../documentation/servlet_bridge.html" title="Servlet bridge"><span class="none"></span>Servlet bridge</a></li>
    <li><a href="../../documentation/console.html" title="Console application"><span class="none"></span>Console application</a></li>
    <li><a href="../../documentation/testing_your_application/getting_started.html" title="Testing"><span class="icon-chevron-right"></span>Testing</a></li>
    <li><a href="../../documentation/debugging.html" title="Debugging"><span class="none"></span>Debugging</a></li>
    <li><a href="../../documentation/security/getting_started.html" title="Security"><span class="none"></span>Security</a></li>
    <li><a href="../../documentation/deployment/getting_started.html" title="Deployment"><span class="icon-chevron-right"></span>Deployment</a></li>
    <li><a href="../../documentation/upgrade_guide.html" title="Upgrade guide"><span class="none"></span>Upgrade guide</a></li>
    <li><a href="../../apidocs/index.html" title="API docs (JavaDoc)"><span class="none"></span>API docs (JavaDoc)</a></li>
      <li class="nav-header">Ninja Modules</li>
    <li><a href="../../documentation/modules.html" title="Overview"><span class="none"></span>Overview</a></li>
      <li class="nav-header">Great community</li>
    <li><a href="https://twitter.com/ninjaframework" class="externalLink" title="@ninjaframework"><span class="none"></span>@ninjaframework</a></li>
    <li><a href="https://groups.google.com/d/forum/ninja-framework" class="externalLink" title="Mailing list"><span class="none"></span>Mailing list</a></li>
    <li><a href="https://github.com/ninjaframework/ninja" class="externalLink" title="Source code"><span class="none"></span>Source code</a></li>
    <li><a href="https://github.com/ninjaframework/ninja/issues" class="externalLink" title="Bug tracker"><span class="none"></span>Bug tracker</a></li>
    <li><a href="../../security.html" title="Security issues"><span class="none"></span>Security issues</a></li>
      <li class="nav-header">For developers</li>
    <li><a href="../../developer/changelog.html" title="Changelog"><span class="none"></span>Changelog</a></li>
    <li><a href="../../developer/roadmap.html" title="Roadmap"><span class="none"></span>Roadmap</a></li>
    <li><a href="../../developer/getting_started.html" title="How to contribute"><span class="none"></span>How to contribute</a></li>
</ul>
<form id="search-form" action="https://www.google.com/search" method="get" >
  <input value="http://www.ninjaframework.org" name="sitesearch" type="hidden"/>
  <input class="search-query" name="q" id="query" type="text" />
</form>
<script type="text/javascript">asyncJs( 'https://cse.google.com/brand?form=search-form' )</script>
          <hr />
          <div id="poweredBy">
    <script type="text/javascript">asyncJs( 'https://apis.google.com/js/plusone.js' )</script>
    <div class="g-plusone" data-href="http://www.ninjaframework.org/ninja-core" data-size="tall" ></div>
            <div class="clear"></div>
            <div class="clear"></div>
    <div id="twitter">
    <a href="https://twitter.com/ninjaframework" class="twitter-follow-button" data-show-count="true" data-align="left" data-size="medium" data-show-screen-name="true" data-lang="en">Follow ninjaframework</a>
    <script type="text/javascript">!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
    </div>
            <div class="clear"></div>
            <div class="clear"></div>
<a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="../../images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </div>
        <div id="bodyColumn"  class="span10" >
<h1>Filtering</h1>
<div class="section">
<h2><a name="Introduction"></a>Introduction</h2>
<p>Powerful powerful powerful. This is what filters are.</p>
<p>Let&#x2019;s say you want to implement authorization in your application. Only users authorized should be able to access a certain route and controller. Otherwise they should get an error page.</p>
<p>There are two principal ways how to add filters to your controller:</p>
<p>Option 1 is to add filters in the Routes file:</p>

<div>
<pre class="prettyprint">
router.GET().route(&quot;/index&quot;).filters(SecureFilter.class).with(AppController::index);  
</pre></div>

<p>Option 2 is to annotate our controller method with a <tt>@FilterWith</tt> annotation:</p>

<div>
<pre class="prettyprint">
@FilterWith(SecureFilter.class)  // Only let authorized users execute the controller method
public Result secureIndex() {    
    /// do something
}    
</pre></div>

<p>Ninja will execute the filter before the method <tt>secureIndex(&#x2026;)</tt>will be called.</p>
<p>The <tt>SecureFilter.class</tt> itself looks like:</p>

<div>
<pre class="prettyprint">
public class SecureFilter implements Filter {

    /** If a username is saved we assume the session is valid */
    public final String USERNAME = &quot;username&quot;;

    @Override
    public Result filter(FilterChain chain, Context context) {

        // if we got no cookies we break:
        if (context.getSession() == null
                || context.getSession().get(USERNAME) == null) {

            return Results.forbidden().html().template(&quot;/views/forbidden403.ftl.html&quot;);

        } else {
            return chain.next(context);
        }

    }
}
</pre></div>

<p><tt>SecureFilter</tt> looks into the session and tries to get a variable called &#x201c;username&#x201d;. If it can do so we can assume the user has been authenticated by us. Please refer to the sessions section for more information why that is the case). The filter then simply calls the next filer in the chain.</p>

<div>
<pre class="prettyprint">
return chain.next(context);
</pre></div>

<p>However - if the variable <i>username</i> is not there we will immediately break the filter chain and will never call the method itself. It instead will return a forbidden status code and render a forbidden view.</p>

<div>
<pre class="prettyprint">
return Results.forbidden().html().template(&quot;/views/forbidden403.ftl.html&quot;);
</pre></div>
</div>
<div class="section">
<h2><a name="Chaining_filters"></a>Chaining filters</h2>
<p>You can define filters that run sequentially either in the Routes file &#x2026;</p>

<div>
<pre class="prettyprint">
router.GET().route(&quot;/index&quot;).filters(LoggerFilter.class, TeaPotFilter.class).with(AppController::index);  
</pre></div>

<p>&#x2026; or by specifying them as annotation:</p>

<div>
<pre class="prettyprint">
@FilterWith({
    LoggerFilter.class, 
    TeaPotFilter.class})
public Result teapot(Context context) {
    // do something
}    
</pre></div>

<p>This method will first call the LoggerFilter and then the TeaPotFilter. Each of the individual filters can break the chain or even alter the result and the context.</p></div>
<div class="section">
<h2><a name="a.40FilterWith_-_class_level_and_inheritance"></a>@FilterWith - class level and inheritance</h2>
<p>You can put <tt>@FilterWith</tt> annotations on method level, but also on class level. If you use <tt>@FilterWith</tt> on class level all methods of this class will be filtered.</p>
<p>Sometimes it is also useful to have a <tt>BaseController</tt> that is annotated with <tt>@FilterWith</tt>. Other controllers extending <tt>BaseContoller</tt> will automatically inherit <tt>@FilterWith</tt>.</p></div>
<div class="section">
<h2><a name="Global_filters"></a>Global filters</h2>
<p>Sometimes it&#x2019;s needed to run filters for every request reaching your application.</p>
<p>This is possible by creating a class Filters in package conf that implements the interface ApplicationFilters:</p>

<div>
<pre class="prettyprint">
package conf;

import java.util.List;
import ninja.application.ApplicationFilters;
import ninja.Filter;

public class Filters implements ApplicationFilters {

    @Override
    public void addFilters(List&lt;Class&lt;? extends Filter&gt;&gt; filters) {
        filters.add(SecureFilter.class);
    }
}
</pre></div>

<p>You can override these global filters for individual routes in the Routes file:</p>

<div>
<pre class="prettyprint">
router.GET().route(&quot;/index&quot;)
            .globalFilters(SecureFilter.class, LoggerFilter.class)
            .with(AppController::index);  
</pre></div>
</div>
<div class="section">
<h2><a name="Passing_values_from_a_filter_to_other_filters.2Fcontroller"></a>Passing values from a filter to other filters/controller</h2>
<p>The most common filter examples for Ninja demonstrate how to use filters to set session values.  However, non-session values can also be created in filters and passed onto other filters or your controller.</p>
<p>The <tt>context</tt> parameter included with the <tt>filter</tt> method supports setting arbitrary attributes (values) for the current request.</p>

<div>
<pre class="prettyprint">
public class ExampleFilter implements Filter {

    @Override
    public Result filter(FilterChain chain, Context context) {

        context.setAttribute(&quot;foo&quot;, &quot;bar&quot;);

        return chain.next(context);

    }
}
</pre></div>

<p>In another filter or your controller, you can fetch the value of &#x201c;foo&#x201d; by getting the attribute.</p>

<div>
<pre class="prettyprint">
public MyController {

    @FilterWith(ExampleFilter.class)
    public Result exampleMethod(Context context) {
        
        String foo = context.getAttribute(&quot;foo&quot;);

        // foo will equal &quot;bar&quot;

    }
}
</pre></div>

<p>Alternatively, an even more powerful design pattern is to write your own <tt>ArgumentExtractor</tt> that extracts the attribute value and have it automatically injected into your controller.  Visit the <a href="/documentation/basic_concepts/argument_extractors.html">argument extractors</a> page for more info.</p></div>
<div class="section">
<h2><a name="BasicAuthFilter"></a>BasicAuthFilter</h2>
<p>Ninja ships with an implementation of HTTP Basic Authentication.  You need to bind a <tt>UsernamePasswordValidator</tt> in your <tt>conf.Modules</tt> class and then annotate your secured controllers or controller methods with <tt>@FilterWith(BasicAuthFilter)</tt>.</p>

<div>
<pre class="prettyprint">
public class Module extends AbstractModule {

    @Override
    protected void configure() {

		// bind a UsernamePasswordValidator
		bind(UsernamePasswordValidator.class).toInstance(new UsernamePasswordValidator() {

			@Override
			public boolean validateCredentials(String username, String password) {
				return &quot;user&quot;.equals(username) &amp;&amp; &quot;password&quot;.equals(password);
			}
		});
    }
}

public MyController {

    @FilterWith(BasicAuthFilter.class)
    public Result secureMethod(Context context) {
        // do something
    }
    
}    
</pre></div></div>
        </div>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>Copyright &copy;2019
<a href="http://www.ninjaframework.org">ninjaframework</a>.
All rights reserved.</p>
        </div>
      </div>
    </footer>
  </body>
</html>
