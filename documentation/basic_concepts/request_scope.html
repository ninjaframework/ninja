<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.11.1 from src/site/markdown/documentation/basic_concepts/request_scope.md at 2023-12-07
 | Rendered using Apache Maven Fluido Skin 1.7
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20231207" />
    <meta http-equiv="Content-Language" content="en" />
    <title>Ninja &#x2013; Request scope facilities</title>
    <link rel="stylesheet" href="../../css/apache-maven-fluido-1.7.min.css" />
    <link rel="stylesheet" href="../../css/site.css" />
    <link rel="stylesheet" href="../../css/print.css" media="print" />
    <script type="text/javascript" src="../../js/apache-maven-fluido-1.7.min.js"></script>
<meta name="description"
                  content="Ninja is a full stack web framework for Java.
                    Rock solid, fast and super productive."/>
            <link rel="icon" type="image/png" href="favicon.png" />

            <link href='//fonts.googleapis.com/css?family=Titillium+Web' rel='stylesheet' type='text/css'/>
            <link href='//fonts.googleapis.com/css?family=Inconsolata' rel='stylesheet' type='text/css'/>
            <link href='//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css' rel='stylesheet' type='text/css'/>

            <script type="text/javascript">

                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-38154034-1']);
                _gaq.push(['_trackPageview']);

                (function() {
                var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                })();

            </script>
  </head>
  <body class="topBarDisabled">
    <a href="https://github.com/ninjaframework/ninja">
      <img style="position: absolute; top: 0; right: 0; border: 0; z-index: 10000;"
        src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png"
        alt="Fork me on GitHub">
    </a>
    <div class="container-fluid">
      <div id="banner">
        <div class="pull-left"><a href="../../.." id="bannerLeft" title="Ninja web framework"><img src="../../ninja_logo.png"  alt="Ninja web framework"/></a></div>
        <div class="pull-right"></div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
        <li id="publishDate" class="pull-right"><span class="divider">|</span> Last Published: 2023-12-07</li>
          <li id="projectVersion" class="pull-right">Version: 7.0.1-SNAPSHOT</li>
        </ul>
      </div>
      <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
    <ul class="nav nav-list">
      <li class="nav-header">Introduction</li>
    <li><a href="../../introduction.html" title="The problem we solve"><span class="none"></span>The problem we solve</a></li>
    <li><a href="../../high_level_overview.html" title="Ninja - high level overview"><span class="none"></span>Ninja - high level overview</a></li>
    <li><a href="../../team.html" title="The team"><span class="none"></span>The team</a></li>
      <li class="nav-header">Commercial support</li>
    <li><a href="../../commercial_support/philosophy.html" title="Philosophy"><span class="none"></span>Philosophy</a></li>
    <li><a href="../../commercial_support/training.html" title="Training"><span class="none"></span>Training</a></li>
    <li><a href="../../commercial_support/support_plans.html" title="Support plans"><span class="none"></span>Support plans</a></li>
    <li><a href="../../commercial_support/agile_custom_development.html" title="Custom development"><span class="none"></span>Custom development</a></li>
      <li class="nav-header">Documentation</li>
    <li><a href="../../documentation/getting_started/installing_ninja.html" title="Getting Started"><span class="icon-chevron-right"></span>Getting Started</a></li>
    <li><a href="../../documentation/basic_concepts/basic_concepts.html" title="Basic concepts"><span class="icon-chevron-right"></span>Basic concepts</a></li>
    <li><a href="../../documentation/configuration_and_modes.html" title="Configuration and modes"><span class="none"></span>Configuration and modes</a></li>
    <li><a href="../../documentation/html_templating/getting_started.html" title="HTML templating"><span class="icon-chevron-right"></span>HTML templating</a></li>
    <li><a href="../../documentation/working_with_json_jsonp.html" title="Working with JSON / JSONP"><span class="none"></span>Working with JSON / JSONP</a></li>
    <li><a href="../../documentation/working_with_xml.html" title="Working with XML"><span class="none"></span>Working with XML</a></li>
      <li class="nav-header">Advanced topics</li>
    <li><a href="../../documentation/websockets.html" title="Web Sockets"><span class="none"></span>Web Sockets</a></li>
    <li><a href="../../documentation/validation.html" title="Validation"><span class="none"></span>Validation</a></li>
    <li><a href="../../documentation/content_negotiation.html" title="Content negotiation"><span class="none"></span>Content negotiation</a></li>
    <li><a href="../../documentation/uploading_files.html" title="Uploading files"><span class="none"></span>Uploading files</a></li>
    <li><a href="../../documentation/scheduler.html" title="Scheduler"><span class="none"></span>Scheduler</a></li>
    <li><a href="../../documentation/lifecycle.html" title="Lifecycle"><span class="none"></span>Lifecycle</a></li>
    <li><a href="../../documentation/working_with_relational_dbs/jpa.html" title="Working with relational DBs"><span class="icon-chevron-right"></span>Working with relational DBs</a></li>
    <li><a href="../../documentation/using_the_cache.html" title="Using the cache"><span class="none"></span>Using the cache</a></li>
    <li><a href="../../documentation/internationalization.html" title="Internationalization"><span class="none"></span>Internationalization</a></li>
    <li><a href="../../documentation/static_assets.html" title="Static assets"><span class="none"></span>Static assets</a></li>
    <li><a href="../../documentation/sending_mail.html" title="Sending mail"><span class="none"></span>Sending mail</a></li>
    <li><a href="../../documentation/logging.html" title="Logging"><span class="none"></span>Logging</a></li>
    <li><a href="../../documentation/custom_routing.html" title="Custom routing"><span class="none"></span>Custom routing</a></li>
    <li><a href="../../documentation/servlet_bridge.html" title="Servlet bridge"><span class="none"></span>Servlet bridge</a></li>
    <li><a href="../../documentation/console.html" title="Console application"><span class="none"></span>Console application</a></li>
    <li><a href="../../documentation/testing_your_application/getting_started.html" title="Testing"><span class="icon-chevron-right"></span>Testing</a></li>
    <li><a href="../../documentation/debugging.html" title="Debugging"><span class="none"></span>Debugging</a></li>
    <li><a href="../../documentation/security/getting_started.html" title="Security"><span class="none"></span>Security</a></li>
    <li><a href="../../documentation/deployment/getting_started.html" title="Deployment"><span class="icon-chevron-right"></span>Deployment</a></li>
    <li><a href="../../documentation/upgrade_guide.html" title="Upgrade guide"><span class="none"></span>Upgrade guide</a></li>
    <li><a href="../../apidocs/index.html" title="API docs (JavaDoc)"><span class="none"></span>API docs (JavaDoc)</a></li>
      <li class="nav-header">Ninja Modules</li>
    <li><a href="../../documentation/modules.html" title="Overview"><span class="none"></span>Overview</a></li>
      <li class="nav-header">Great community</li>
    <li><a href="https://twitter.com/ninjaframework" class="externalLink" title="@ninjaframework"><span class="none"></span>@ninjaframework</a></li>
    <li><a href="https://groups.google.com/d/forum/ninja-framework" class="externalLink" title="Mailing list"><span class="none"></span>Mailing list</a></li>
    <li><a href="https://github.com/ninjaframework/ninja" class="externalLink" title="Source code"><span class="none"></span>Source code</a></li>
    <li><a href="https://github.com/ninjaframework/ninja/issues" class="externalLink" title="Bug tracker"><span class="none"></span>Bug tracker</a></li>
    <li><a href="../../security.html" title="Security issues"><span class="none"></span>Security issues</a></li>
      <li class="nav-header">For developers</li>
    <li><a href="../../developer/changelog.html" title="Changelog"><span class="none"></span>Changelog</a></li>
    <li><a href="../../developer/roadmap.html" title="Roadmap"><span class="none"></span>Roadmap</a></li>
    <li><a href="../../developer/getting_started.html" title="How to contribute"><span class="none"></span>How to contribute</a></li>
</ul>
<form id="search-form" action="https://www.google.com/search" method="get" >
  <input value="https://www.ninjaframework.org" name="sitesearch" type="hidden"/>
  <input class="search-query" name="q" id="query" type="text" />
</form>
<script type="text/javascript">asyncJs( 'https://cse.google.com/brand?form=search-form' )</script>
          <hr />
          <div id="poweredBy">
            <div class="clear"></div>
            <div class="clear"></div>
    <div id="twitter">
    <a href="https://twitter.com/ninjaframework" class="twitter-follow-button" data-show-count="true" data-align="left" data-size="medium" data-show-screen-name="true" data-lang="en">Follow ninjaframework</a>
    <script type="text/javascript">!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
    </div>
            <div class="clear"></div>
            <div class="clear"></div>
<a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="../../images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </div>
        <div id="bodyColumn"  class="span9" >
<h1>Request scope facilities</h1>
<p>Http is all about the request. Ninja offers some facilities to handle stuff you have to
do during a request scope. Authentication, and generating objects for a single request are
common examples. The three major players here are:</p>
<ul>

<li>Filters that add values as attributes to the context</li>
<li>Filters that wrap a context and add / remove stuff from the context.</li>
<li>ArgumentExtractors, that allow to inject arbitrary objects into a controller.</li>
</ul><section>
<h2><a name="Attributes_in_Contexts"></a>Attributes in Contexts</h2>
<p>Filters work in a chained manner. At the end you usually call filterChain.next(context) to continue
the filtering.</p>
<p>This is cool, because it offers you the possibility to inject objects into the context for future
use by other filters down the chain or the leaf controller.</p>

<div class="source">
<pre class="prettyprint">
//////////////////////////////////////////////////////////////////////////
// do some stuff like connecting to your database and verifying the user.
//////////////////////////////////////////////////////////////////////////
UserInfo userInfo = &#x2026;; // a complex object, e.g. retrieved from database
context.setAttribute(&quot;userinfo&quot;, userInfo);  
</pre></div>

<p>Then in the controller:</p>

<div class="source">
<pre class="prettyprint">
UserInfo userInfo = context.getAttribute(&quot;userinfo&quot;, UserInfo.class);   
</pre></div>

<p>or even simpler, you can get the <code>UserInfo</code> injected into your controller method's arguments with
<code>@Attribute(&quot;userinfo&quot;) UserInfo userInfo</code>.</p>
<p>Context attributes are very similar to <code>ServletRequest</code>'s attribute, and are implement as such in
<code>ninja-servlet</code>.</p></section><section>
<h2><a name="WrappedContext_in_Filters"></a>WrappedContext in Filters</h2>
<p>Filters also offers you the possibility to replace and partly overwrite the context
with your own context. You can possibly even extend the Context with your own methods and
functions. A good starting point is the class <code>WrappedContext</code> of Ninja.</p>
<p>The following example allows you to inject an arbitrary parameter in the filter chain. This is helpful
if you want to authorize that user by setting (or not setting) the email as parameter.</p>

<div class="source">
<pre class="prettyprint">
//////////////////////////////////////////////////////////////////////////
// do some stuff like connecting to your database and verifying the user.
//////////////////////////////////////////////////////////////////////////
final username = &quot;MyUserName&quot;;

public class WrappedContextFilter implements Filter {

    @Override
    public Result filter(FilterChain filterChain, Context context) {

        WrappedContext wrappedContext = new WrappedContext(context) {

            // Override the getParameter function of the context.
            // This lets you inject parameters in your controller via @Param(&quot;username&quot;)
            // But also have a look at ArgumentExtractors. Maybe they are a cleaner solution
            // to your problem :)
            public String getParameter(String key) {

                if (key.equals(&quot;username&quot;)) {

                    return username;
                } else {

                    return getParameter(key);
                }

            }            
        };

        // Simply continue the chain with the wrapped context
        return filterChain.next(wrappedContext);
    }

}
</pre></div>

<p>You can then use a simple <code>@Param(&quot;username&quot;)</code> to inject the username of your wrapped context into the controller:</p>

<div class="source">
<pre class="prettyprint">
@FilterWith(WrappedContextFilter.class)
public Result index(@Param(&quot;username&quot;) String username) {

    // Usually you would do some authentication or error handling with
    // username...
    logger.log(&quot;username: &quot; + username); //this will be MyUserName

    return Results.html();

}  
</pre></div>    
</section><section>
<h2><a name="Argument_Extractors"></a>Argument Extractors</h2>
<p>Injecting stuff into your controller via</p>

<div class="source">
<pre class="prettyprint">
public Result index(@Param(&quot;username&quot;) String username) { ... }  
</pre></div>

<p>is really nice, but what about creating your own annotations for custom controller injections?
Well. This is pretty simple and can be accomplished by Ninja's <code>ArgumentExtractors</code>. <code>@Param</code> is also
just an <code>ArgumentExtractor</code> by the way.</p>
<p>Let's say we want to inject a User object into our controller based on e.g. logged in status.
First you have to define your own annotation interface like so:</p>

<div class="source">
<pre class="prettyprint">
@WithArgumentExtractor(LoggedInUserExtractor.class)
@Retention(RetentionPolicy.RUNTIME)
@Target({ ElementType.PARAMETER })
public @interface LoggedInUser {
    // Just a marker interface
}  
</pre></div>

<p>You can of course also use annotations with values like in <code>@Param</code>. But we want keep things simple for now.
The next step is to write your own <code>ArgumentExtractor</code> for your <code>User</code> object:</p>

<div class="source">
<pre class="prettyprint">
public class LoggedInUserExtractor implements ArgumentExtractor&lt;User&gt; {

    @Override
    public User extract(Context context) {                    
        //////////////////////////////////////////////////////////////////
        // Usually you would now extract stuff from the context
        // and contact your db to check if user is authenticated or so...        
        ///////////////////////////////////////////////////////////////////
        User user = new User();
        user.email = &quot;user@example.com&quot;;
        return user;
    }

    @Override
    public Class&lt;User&gt; getExtractedType() {
        return User.class;
    }

    @Override
    public String getFieldName() {
        return null;
    }
}  
</pre></div>

<p>And then you can simply use that extractor as annotation in your controller to inject a user during a request:</p>

<div class="source">
<pre class="prettyprint">
public Result index(@LoggedInUser User user) {

    System.out.println(&quot;user's email: &quot; + user.email); //will be user@example.com
    // Usually you want to do some more complex logic here...

    return Results.html();

} 
</pre></div>

<p>That's almost everything you have to know about <code>ArgumentExtractors</code>. They really facilitate injection of arbitrary objects into
your controller during a request.</p></section><section>
<h2><a name="Built-in_argument_extractors"></a>Built-in argument extractors</h2>
<p>Ninja features some extractors and classes you can inject into your
controller methods out of the box:</p>
<ul>

<li><code>Context context</code></li>
<li><code>SessionCookie sessionCookie</code></li>
<li><code>FlashCookie flashCookie</code></li>
<li><code>@Param(&#x201c;paramName&#x201d;) String name</code></li>
<li><code>@PathParam(&#x201c;pathParamName&#x201d;) String name</code></li>
<li><code>@SessionParam(&#x201c;paramName&#x201d;) String sessionParamName</code></li>
<li><code>@Request HttpServletRequest httpServletRequest</code> (Only on servlet environments)</li>
<li><code>@Response HttpServletResponse httpServletResponse</code> (Only on servlet environments)</li>
</ul></section>
        </div>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>Copyright &copy;2023
<a href="https://www.ninjaframework.org">ninjaframework</a>.
All rights reserved.</p>
        </div>
      </div>
    </footer>
  </body>
</html>
