<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at 2017-08-03 
 | Rendered using Apache Maven Fluido Skin 1.3.1
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20170803" />
    <meta http-equiv="Content-Language" content="en" />
    <title>Ninja - full stack web framework for Java - </title>
    <link rel="stylesheet" href="../../css/apache-maven-fluido-1.3.1.min.css" />
    <link rel="stylesheet" href="../../css/site.css" />
    <link rel="stylesheet" href="../../css/print.css" media="print" />

      
    <script type="text/javascript" src="../../js/apache-maven-fluido-1.3.1.min.js"></script>

                          
        
<meta name="description" content="Ninja is a full stack web framework for Java.                     Rock solid, fast and super productive."/>
                      
        
<link rel="icon" href="favicon.png" type="image/png"/>
                      
        
<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Titillium+Web" type="text/css"/>
                      
        
<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Inconsolata" type="text/css"/>
                      
        
<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" type="text/css"/>
                      
        
<script type="text/javascript">var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-38154034-1']);
                _gaq.push(['_trackPageview']);

                (function() {
                var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                })();</script>
          
                  </head>
        <body class="topBarDisabled">
          
    
    
            
    
        
    <a href="http://github.com/ninjaframework/ninja">
      <img style="position: absolute; top: 0; right: 0; border: 0; z-index: 10000;"
        src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png"
        alt="Fork me on GitHub">
    </a>
  
                
                    
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                                  <a href="../../.." id="bannerLeft" title="Ninja web framework">
                                                                                                <img src="../../ninja_logo.png"  alt="Ninja web framework"/>
                </a>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
                    
            
                
                    
                  <li id="publishDate" class="pull-right"><span class="divider">|</span> Last Published: 2017-08-03</li>
              <li id="projectVersion" class="pull-right">
                    Version: 6.1.0
        </li>
            
                            </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
                
                    
                <ul class="nav nav-list">
                    <li class="nav-header">Introduction</li>
                              
      <li>
  
                          <a href="../../introduction.html" title="The problem we solve">
          <i class="none"></i>
        The problem we solve</a>
            </li>
                
      <li>
  
                          <a href="../../high_level_overview.html" title="Ninja - high level overview">
          <i class="none"></i>
        Ninja - high level overview</a>
            </li>
                
      <li>
  
                          <a href="../../team.html" title="The team">
          <i class="none"></i>
        The team</a>
            </li>
                              <li class="nav-header">Commercial support</li>
                              
      <li>
  
                          <a href="../../commercial_support/philosophy.html" title="Philosophy">
          <i class="none"></i>
        Philosophy</a>
            </li>
                
      <li>
  
                          <a href="../../commercial_support/training.html" title="Training">
          <i class="none"></i>
        Training</a>
            </li>
                
      <li>
  
                          <a href="../../commercial_support/support_plans.html" title="Support plans">
          <i class="none"></i>
        Support plans</a>
            </li>
                
      <li>
  
                          <a href="../../commercial_support/agile_custom_development.html" title="Custom development">
          <i class="none"></i>
        Custom development</a>
            </li>
                              <li class="nav-header">Documentation</li>
                                                                                                                    
      <li>
  
                          <a href="../../documentation/getting_started/installing_ninja.html" title="Getting Started">
          <i class="icon-chevron-right"></i>
        Getting Started</a>
                  </li>
                                                                                                                                                                                                                                    
      <li>
  
                          <a href="../../documentation/basic_concepts/basic_concepts.html" title="Basic concepts">
          <i class="icon-chevron-right"></i>
        Basic concepts</a>
                  </li>
                
      <li>
  
                          <a href="../../documentation/configuration_and_modes.html" title="Configuration and modes">
          <i class="none"></i>
        Configuration and modes</a>
            </li>
                                                                                                                        
      <li>
  
                          <a href="../../documentation/html_templating/getting_started.html" title="HTML templating">
          <i class="icon-chevron-right"></i>
        HTML templating</a>
                  </li>
                
      <li>
  
                          <a href="../../documentation/working_with_json_jsonp.html" title="Working with JSON / JSONP">
          <i class="none"></i>
        Working with JSON / JSONP</a>
            </li>
                
      <li>
  
                          <a href="../../documentation/working_with_xml.html" title="Working with XML">
          <i class="none"></i>
        Working with XML</a>
            </li>
                              <li class="nav-header">Advanced topics</li>
                              
      <li>
  
                          <a href="../../documentation/validation.html" title="Validation">
          <i class="none"></i>
        Validation</a>
            </li>
                
      <li>
  
                          <a href="../../documentation/content_negotiation.html" title="Content negotiation">
          <i class="none"></i>
        Content negotiation</a>
            </li>
                
      <li>
  
                          <a href="../../documentation/uploading_files.html" title="Uploading files">
          <i class="none"></i>
        Uploading files</a>
            </li>
                
      <li>
  
                          <a href="../../documentation/scheduler.html" title="Scheduler">
          <i class="none"></i>
        Scheduler</a>
            </li>
                
      <li>
  
                          <a href="../../documentation/lifecycle.html" title="Lifecycle">
          <i class="none"></i>
        Lifecycle</a>
            </li>
                                                                  
      <li>
  
                          <a href="../../documentation/working_with_relational_dbs/jpa.html" title="Working with relational DBs">
          <i class="icon-chevron-right"></i>
        Working with relational DBs</a>
                  </li>
                
      <li>
  
                          <a href="../../documentation/using_the_cache.html" title="Using the cache">
          <i class="none"></i>
        Using the cache</a>
            </li>
                
      <li>
  
                          <a href="../../documentation/internationalization.html" title="Internationalization">
          <i class="none"></i>
        Internationalization</a>
            </li>
                
      <li>
  
                          <a href="../../documentation/static_assets.html" title="Static assets">
          <i class="none"></i>
        Static assets</a>
            </li>
                
      <li>
  
                          <a href="../../documentation/sending_mail.html" title="Sending mail">
          <i class="none"></i>
        Sending mail</a>
            </li>
                
      <li>
  
                          <a href="../../documentation/logging.html" title="Logging">
          <i class="none"></i>
        Logging</a>
            </li>
                
      <li>
  
                          <a href="../../documentation/custom_routing.html" title="Custom routing">
          <i class="none"></i>
        Custom routing</a>
            </li>
                
      <li>
  
                          <a href="../../documentation/servlet_bridge.html" title="Servlet bridge">
          <i class="none"></i>
        Servlet bridge</a>
            </li>
                                                                                                                                                            
      <li>
  
                          <a href="../../documentation/testing_your_application/getting_started.html" title="Testing">
          <i class="icon-chevron-right"></i>
        Testing</a>
                  </li>
                
      <li>
  
                          <a href="../../documentation/debugging.html" title="Debugging">
          <i class="none"></i>
        Debugging</a>
            </li>
                
      <li>
  
                          <a href="../../documentation/security/getting_started.html" title="Security">
          <i class="none"></i>
        Security</a>
            </li>
                                                                                                                        
      <li>
  
                          <a href="../../documentation/deployment/getting_started.html" title="Deployment">
          <i class="icon-chevron-right"></i>
        Deployment</a>
                  </li>
                
      <li>
  
                          <a href="../../documentation/upgrade_guide.html" title="Upgrade guide">
          <i class="none"></i>
        Upgrade guide</a>
            </li>
                
      <li>
  
                          <a href="../../apidocs/index.html" title="API docs (JavaDoc)">
          <i class="none"></i>
        API docs (JavaDoc)</a>
            </li>
                              <li class="nav-header">Ninja Modules</li>
                              
      <li>
  
                          <a href="../../documentation/modules.html" title="Overview">
          <i class="none"></i>
        Overview</a>
            </li>
                              <li class="nav-header">Great community</li>
                              
      <li>
  
                          <a href="https://twitter.com/ninjaframework" class="externalLink" title="@ninjaframework">
          <i class="none"></i>
        @ninjaframework</a>
            </li>
                
      <li>
  
                          <a href="https://groups.google.com/d/forum/ninja-framework" class="externalLink" title="Mailing list">
          <i class="none"></i>
        Mailing list</a>
            </li>
                
      <li>
  
                          <a href="https://github.com/ninjaframework/ninja" class="externalLink" title="Source code">
          <i class="none"></i>
        Source code</a>
            </li>
                
      <li>
  
                          <a href="https://github.com/ninjaframework/ninja/issues" class="externalLink" title="Bug tracker">
          <i class="none"></i>
        Bug tracker</a>
            </li>
                
      <li>
  
                          <a href="../../security.html" title="Security issues">
          <i class="none"></i>
        Security issues</a>
            </li>
                              <li class="nav-header">For developers</li>
                              
      <li>
  
                          <a href="../../developer/changelog.html" title="Changelog">
          <i class="none"></i>
        Changelog</a>
            </li>
                
      <li>
  
                          <a href="../../developer/roadmap.html" title="Roadmap">
          <i class="none"></i>
        Roadmap</a>
            </li>
                
      <li>
  
                          <a href="../../developer/getting_started.html" title="How to contribute">
          <i class="none"></i>
        How to contribute</a>
            </li>
            </ul>
                
                    
                            <form id="search-form" action="http://www.google.com/search" method="get" >
    
  <input value="http://www.ninjaframework.org" name="sitesearch" type="hidden"/>
  <input class="search-query" name="q" id="query" type="text" />
</form>
<script type="text/javascript" src="http://www.google.com/coop/cse/brand?form=search-form"></script>
          
          <hr />

           <div id="poweredBy">
                   
    <script type="text/javascript" src="https://apis.google.com/js/plusone.js"></script>

    
    <div class="g-plusone" data-href="http://www.ninjaframework.org/ninja-core" data-size="tall" ></div>

                   <div class="clear"></div>
                            <div class="clear"></div>
               
        
        
        <div id="twitter">
    
    <a href="https://twitter.com/ninjaframework" class="twitter-follow-button" data-show-count="true" data-align="left" data-size="medium" data-show-screen-name="true" data-lang="en">Follow ninjaframework</a>
    <script type="text/javascript">!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>

        </div>
                   <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="../../images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span9" >
                                  
            <h1>Request scope facilities</h1><p>Http is all about the request. Ninja offers some facilities to handle stuff you have to
do during a request scope. Authentication, and generating objects for a single request are
common examples. The three major players here are:</p>
<ul>
  <li>Filters that add values as attributes to the context</li><li>Filters that wrap a context and add / remove stuff from the context.</li><li>ArgumentExtractors, that allow to inject arbitrary objects into a controller.</li>
</ul><h2>Attributes in Contexts</h2><p>Filters work in a chained manner. At the end you usually call filterChain.next(context) to continue
the filtering.</p><p>This is cool, because it offers you the possibility to inject objects into the context for future
use by other filters down the chain or the leaf controller.</p>
<pre class="prettyprint">
//////////////////////////////////////////////////////////////////////////
// do some stuff like connecting to your database and verifying the user.
//////////////////////////////////////////////////////////////////////////
UserInfo userInfo = â€¦; // a complex object, e.g. retrieved from database
context.setAttribute("userinfo", userInfo);  
</pre><p>Then in the controller:</p>
<pre class="prettyprint">
UserInfo userInfo = context.getAttribute("userinfo", UserInfo.class);   
</pre><p>or even simpler, you can get the <code>UserInfo</code> injected into your controller method&rsquo;s arguments with
<code>@Attribute(&quot;userinfo&quot;) UserInfo userInfo</code>.</p><p>Context attributes are very similar to <code>ServletRequest</code>&rsquo;s attribute, and are implement as such in
<code>ninja-servlet</code>.</p><h2>WrappedContext in Filters</h2><p>Filters also offers you the possibility to replace and partly overwrite the context
with your own context. You can possibly even extend the Context with your own methods and
functions. A good starting point is the class <code>WrappedContext</code> of Ninja.</p><p>The following example allows you to inject an arbitrary parameter in the filter chain. This is helpful
if you want to authorize that user by setting (or not setting) the email as parameter.</p>
<pre class="prettyprint">
//////////////////////////////////////////////////////////////////////////
// do some stuff like connecting to your database and verifying the user.
//////////////////////////////////////////////////////////////////////////
final username = "MyUserName";

public class WrappedContextFilter implements Filter {

    @Override
    public Result filter(FilterChain filterChain, Context context) {

        WrappedContext wrappedContext = new WrappedContext(context) {

            // Override the getParameter function of the context.
            // This lets you inject parameters in your controller via @Param("username")
            // But also have a look at ArgumentExtractors. Maybe they are a cleaner solution
            // to your problem :)
            public String getParameter(String key) {

                if (key.equals("username")) {

                    return username;
                } else {

                    return getParameter(key);
                }

            }            
        };

        // Simply continue the chain with the wrapped context
        return filterChain.next(wrappedContext);
    }

}
</pre><p>You can then use a simple <code>@Param(&quot;username&quot;)</code> to inject the username of your wrapped context into the controller:</p>
<pre class="prettyprint">
@FilterWith(WrappedContextFilter.class)
public Result index(@Param("username") String username) {

    // Usually you would do some authentication or error handling with
    // username...
    logger.log("username: " + username); //this will be MyUserName

    return Results.html();

}  
</pre><h2>Argument Extractors</h2><p>Injecting stuff into your controller via </p>
<pre class="prettyprint">
public Result index(@Param("username") String username) { ... }  
</pre><p>is really nice, but what about creating your own annotations for custom controller injections?
Well. This is pretty simple and can be accomplished by Ninja&rsquo;s <code>ArgumentExtractors</code>. <code>@Param</code> is also
just an <code>ArgumentExtractor</code> by the way.</p><p>Let&rsquo;s say we want to inject a User object into our controller based on e.g. logged in status.
First you have to define your own annotation interface like so:</p>
<pre class="prettyprint">
@WithArgumentExtractor(LoggedInUserExtractor.class)
@Retention(RetentionPolicy.RUNTIME)
@Target({ ElementType.PARAMETER })
public @interface LoggedInUser {
    // Just a marker interface
}  
</pre><p>You can of course also use annotations with values like in <code>@Param</code>. But we want keep things simple for now.
The next step is to write your own <code>ArgumentExtractor</code> for your <code>User</code> object:</p>
<pre class="prettyprint">
public class LoggedInUserExtractor implements ArgumentExtractor&#60;User&#62; {

    @Override
    public User extract(Context context) {                    
        //////////////////////////////////////////////////////////////////
        // Usually you would now extract stuff from the context
        // and contact your db to check if user is authenticated or so...        
        ///////////////////////////////////////////////////////////////////
        User user = new User();
        user.email = "user@example.com";
        return user;
    }

    @Override
    public Class&#60;User&#62; getExtractedType() {
        return User.class;
    }

    @Override
    public String getFieldName() {
        return null;
    }
}  
</pre><p>And then you can simply use that extractor as annotation in your controller to inject a user during a request:</p>
<pre class="prettyprint">
public Result index(@LoggedInUser User user) {

    System.out.println("user's email: " + user.email); //will be user@example.com
    // Usually you want to do some more complex logic here...

    return Results.html();

} 
</pre><p>That&rsquo;s almost everything you have to know about <code>ArgumentExtractors</code>. They really facilitate injection of arbitrary objects into
your controller during a request.</p><h2>Built-in argument extractors</h2><p>Ninja features some extractors and classes you can inject into your
controller methods out of the box:</p>
<ul>
  <li><code>Context context</code></li><li><code>SessionCookie sessionCookie</code></li><li><code>FlashCookie flashCookie</code></li><li><code>@Param(&ldquo;paramName&rdquo;) String name</code></li><li><code>@PathParam(&ldquo;pathParamName&rdquo;) String name</code></li><li><code>@SessionParam(&ldquo;paramName&rdquo;) String sessionParamName</code></li><li><code>@Request HttpServletRequest httpServletRequest</code> (Only on servlet environments)</li><li><code>@Response HttpServletResponse httpServletResponse</code> (Only on servlet environments)</li>
</ul>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
                      <div class="row-fluid">
                              <p >Copyright &copy;                    2017
                        <a href="http://www.ninjaframework.org">ninjaframework</a>.
            All rights reserved.      
                    
      </p>
        </div>

        
        
                </div>
    </footer>
        </body>
</html>
