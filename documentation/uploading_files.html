<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.8.1 from src/site/markdown/documentation/uploading_files.md at 2019-10-06
 | Rendered using Apache Maven Fluido Skin 1.7
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20191006" />
    <meta http-equiv="Content-Language" content="en" />
    <title>Ninja &#x2013; Uploading files</title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-1.7.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />
    <script type="text/javascript" src="../js/apache-maven-fluido-1.7.min.js"></script>
<meta name="description"
                  content="Ninja is a full stack web framework for Java.
                    Rock solid, fast and super productive."/>
            <link rel="icon" type="image/png" href="favicon.png" />

            <link href='//fonts.googleapis.com/css?family=Titillium+Web' rel='stylesheet' type='text/css'/>
            <link href='//fonts.googleapis.com/css?family=Inconsolata' rel='stylesheet' type='text/css'/>
            <link href='//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css' rel='stylesheet' type='text/css'/>

            <script type="text/javascript">

                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-38154034-1']);
                _gaq.push(['_trackPageview']);

                (function() {
                var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                })();

            </script>
  </head>
  <body class="topBarDisabled">
    <a href="https://github.com/ninjaframework/ninja">
      <img style="position: absolute; top: 0; right: 0; border: 0; z-index: 10000;"
        src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png"
        alt="Fork me on GitHub">
    </a>
    <div class="container-fluid">
      <div id="banner">
        <div class="pull-left"><a href="../.." id="bannerLeft" title="Ninja web framework"><img src="../ninja_logo.png"  alt="Ninja web framework"/></a></div>
        <div class="pull-right"></div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
        <li id="publishDate" class="pull-right"><span class="divider">|</span> Last Published: 2019-10-06</li>
          <li id="projectVersion" class="pull-right">Version: 6.6.0</li>
        </ul>
      </div>
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
    <ul class="nav nav-list">
      <li class="nav-header">Introduction</li>
    <li><a href="../introduction.html" title="The problem we solve"><span class="none"></span>The problem we solve</a></li>
    <li><a href="../high_level_overview.html" title="Ninja - high level overview"><span class="none"></span>Ninja - high level overview</a></li>
    <li><a href="../team.html" title="The team"><span class="none"></span>The team</a></li>
      <li class="nav-header">Commercial support</li>
    <li><a href="../commercial_support/philosophy.html" title="Philosophy"><span class="none"></span>Philosophy</a></li>
    <li><a href="../commercial_support/training.html" title="Training"><span class="none"></span>Training</a></li>
    <li><a href="../commercial_support/support_plans.html" title="Support plans"><span class="none"></span>Support plans</a></li>
    <li><a href="../commercial_support/agile_custom_development.html" title="Custom development"><span class="none"></span>Custom development</a></li>
      <li class="nav-header">Documentation</li>
    <li><a href="../documentation/getting_started/installing_ninja.html" title="Getting Started"><span class="icon-chevron-right"></span>Getting Started</a></li>
    <li><a href="../documentation/basic_concepts/basic_concepts.html" title="Basic concepts"><span class="icon-chevron-right"></span>Basic concepts</a></li>
    <li><a href="../documentation/configuration_and_modes.html" title="Configuration and modes"><span class="none"></span>Configuration and modes</a></li>
    <li><a href="../documentation/html_templating/getting_started.html" title="HTML templating"><span class="icon-chevron-right"></span>HTML templating</a></li>
    <li><a href="../documentation/working_with_json_jsonp.html" title="Working with JSON / JSONP"><span class="none"></span>Working with JSON / JSONP</a></li>
    <li><a href="../documentation/working_with_xml.html" title="Working with XML"><span class="none"></span>Working with XML</a></li>
      <li class="nav-header">Advanced topics</li>
    <li><a href="../documentation/websockets.html" title="Web Sockets"><span class="none"></span>Web Sockets</a></li>
    <li><a href="../documentation/validation.html" title="Validation"><span class="none"></span>Validation</a></li>
    <li><a href="../documentation/content_negotiation.html" title="Content negotiation"><span class="none"></span>Content negotiation</a></li>
    <li class="active"><a href="#"><span class="none"></span>Uploading files</a></li>
    <li><a href="../documentation/scheduler.html" title="Scheduler"><span class="none"></span>Scheduler</a></li>
    <li><a href="../documentation/lifecycle.html" title="Lifecycle"><span class="none"></span>Lifecycle</a></li>
    <li><a href="../documentation/working_with_relational_dbs/jpa.html" title="Working with relational DBs"><span class="icon-chevron-right"></span>Working with relational DBs</a></li>
    <li><a href="../documentation/using_the_cache.html" title="Using the cache"><span class="none"></span>Using the cache</a></li>
    <li><a href="../documentation/internationalization.html" title="Internationalization"><span class="none"></span>Internationalization</a></li>
    <li><a href="../documentation/static_assets.html" title="Static assets"><span class="none"></span>Static assets</a></li>
    <li><a href="../documentation/sending_mail.html" title="Sending mail"><span class="none"></span>Sending mail</a></li>
    <li><a href="../documentation/logging.html" title="Logging"><span class="none"></span>Logging</a></li>
    <li><a href="../documentation/custom_routing.html" title="Custom routing"><span class="none"></span>Custom routing</a></li>
    <li><a href="../documentation/servlet_bridge.html" title="Servlet bridge"><span class="none"></span>Servlet bridge</a></li>
    <li><a href="../documentation/console.html" title="Console application"><span class="none"></span>Console application</a></li>
    <li><a href="../documentation/testing_your_application/getting_started.html" title="Testing"><span class="icon-chevron-right"></span>Testing</a></li>
    <li><a href="../documentation/debugging.html" title="Debugging"><span class="none"></span>Debugging</a></li>
    <li><a href="../documentation/security/getting_started.html" title="Security"><span class="none"></span>Security</a></li>
    <li><a href="../documentation/deployment/getting_started.html" title="Deployment"><span class="icon-chevron-right"></span>Deployment</a></li>
    <li><a href="../documentation/upgrade_guide.html" title="Upgrade guide"><span class="none"></span>Upgrade guide</a></li>
    <li><a href="../apidocs/index.html" title="API docs (JavaDoc)"><span class="none"></span>API docs (JavaDoc)</a></li>
      <li class="nav-header">Ninja Modules</li>
    <li><a href="../documentation/modules.html" title="Overview"><span class="none"></span>Overview</a></li>
      <li class="nav-header">Great community</li>
    <li><a href="https://twitter.com/ninjaframework" class="externalLink" title="@ninjaframework"><span class="none"></span>@ninjaframework</a></li>
    <li><a href="https://groups.google.com/d/forum/ninja-framework" class="externalLink" title="Mailing list"><span class="none"></span>Mailing list</a></li>
    <li><a href="https://github.com/ninjaframework/ninja" class="externalLink" title="Source code"><span class="none"></span>Source code</a></li>
    <li><a href="https://github.com/ninjaframework/ninja/issues" class="externalLink" title="Bug tracker"><span class="none"></span>Bug tracker</a></li>
    <li><a href="../security.html" title="Security issues"><span class="none"></span>Security issues</a></li>
      <li class="nav-header">For developers</li>
    <li><a href="../developer/changelog.html" title="Changelog"><span class="none"></span>Changelog</a></li>
    <li><a href="../developer/roadmap.html" title="Roadmap"><span class="none"></span>Roadmap</a></li>
    <li><a href="../developer/getting_started.html" title="How to contribute"><span class="none"></span>How to contribute</a></li>
</ul>
<form id="search-form" action="https://www.google.com/search" method="get" >
  <input value="http://www.ninjaframework.org" name="sitesearch" type="hidden"/>
  <input class="search-query" name="q" id="query" type="text" />
</form>
<script type="text/javascript">asyncJs( 'https://cse.google.com/brand?form=search-form' )</script>
          <hr />
          <div id="poweredBy">
    <script type="text/javascript">asyncJs( 'https://apis.google.com/js/plusone.js' )</script>
    <div class="g-plusone" data-href="http://www.ninjaframework.org/ninja-core" data-size="tall" ></div>
            <div class="clear"></div>
            <div class="clear"></div>
    <div id="twitter">
    <a href="https://twitter.com/ninjaframework" class="twitter-follow-button" data-show-count="true" data-align="left" data-size="medium" data-show-screen-name="true" data-lang="en">Follow ninjaframework</a>
    <script type="text/javascript">!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
    </div>
            <div class="clear"></div>
            <div class="clear"></div>
<a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="../images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </div>
        <div id="bodyColumn"  class="span10" >
<h1>Uploading files</h1>
<div class="section">
<h2><a name="Handling_multipart.2Fform-data_uploads"></a>Handling multipart/form-data uploads</h2>
<p>Ninja offers direct access to file uploads in your controller method. This is accomplished via the Context object and two of its methods: <tt>context.isMultipart()</tt> to check if we are dealing with a multipart upload and <tt>context.getFileItemIterator()</tt> to iterate through potential files.</p>
<p>Usually you render a form that links to the controller that will handle the upload. In the following case we are using a route to <tt>/upload</tt>.</p>

<div>
<pre class="prettyprint">
&lt;form method=&quot;post&quot; enctype=&quot;multipart/form-data&quot; action=&quot;/upload&quot;&gt;
    Please specify file to upload: &lt;input type=&quot;file&quot; name=&quot;upfile&quot;&gt;&lt;br /&gt;
    &lt;input type=&quot;submit&quot; value=&quot;submit&quot;&gt;
&lt;/form&gt;
</pre></div>

<p>Note that you&#x2019;ll be able to still get your other form values inside a proper DTO : <tt>public Result upload(Context context, MyDto formObject, @Param(&#x201c;file&#x201d;) File file) { &#x2026; }</tt>.</p></div>
<div class="section">
<h2><a name="The_manual_default_way"></a>The manual default way</h2>
<p>The controller at <tt>/uploadFinish</tt> will then handle the upload:</p>

<div>
<pre class="prettyprint">
public Result uploadFinish(Context context) throws Exception {

    // Make sure the context really is a multipart context...
    if (context.isMultipart()) {

        // This is the iterator we can use to iterate over the
        // contents of the request.
        FileItemIterator fileItemIterator = context
                .getFileItemIterator();

        while (fileItemIterator.hasNext()) {

            FileItemStream item = fileItemIterator.next();

            String name = item.getFieldName();
            InputStream stream = item.openStream();

            String contentType = item.getContentType();

            if (item.isFormField()) {

                // do something with the form field

            } else {

                // process file as input stream

            }
        }

    }
    
    // We always return ok. You don't want to do that in production ;)
    return Results.ok();

}
</pre></div>
</div>
<div class="section">
<h2><a name="The_integrated_new_way"></a>The integrated new way</h2>
<p>The controller at <tt>/uploadFinish</tt> can automatically handle the upload, and return either a FileItem, InputStream or File. Using FileItem allows provides access to additional properties, like <tt>getFileName()</tt> to get the original file name sent by the browser. <b>NOTE:</b> By default, the file provider is set to <tt>NoFileItemProvider</tt> - in order to use this new way, you need to configure a file provider as described below.</p>

<div>
<pre class="prettyprint">
public Result uploadFinish(Context context, @Param(&quot;upfile&quot;) FileItem upfile) throws Exception {
}
</pre></div>

<p>or</p>

<div>
<pre class="prettyprint">
public Result uploadFinish(Context context, @Param(&quot;upfile&quot;) InputStream upfile) throws Exception {
}
</pre></div>

<p>or</p>

<div>
<pre class="prettyprint">
public Result uploadFinish(Context context, @Param(&quot;upfile&quot;) File upfile) throws Exception {
}
</pre></div>

<p>or</p>

<div>
<pre class="prettyprint">
public Result uploadFinish(Context context) throws Exception {
    FileItem upfile = context.getParameterAsFileItem(&quot;upfile&quot;);
}
</pre></div>

<div class="section">
<h3><a name="In-memory_or_disk_based_file_.3F"></a>In-memory or disk based file ?</h3>
<p>Ninja comes with two providers to choose between in-memory and disk file for storing uploaded content: - <tt>MemoryFileItemProvider</tt>, to stores the file bytes into memory - <tt>DiskFileItemProvider</tt>, to stores the file content to disk in a temporary folder, that can be set using the <tt>uploads.temp_folder</tt> ninja property</p>
<p>In all case, you can limit the size of each file using <tt>uploads.max_file_size</tt> and the total size of all files using <tt>uploads.max_total_size</tt> ninja properties.</p>

<div class="alert alert-info">
When using disk base storage, uploaded files are automatically deleted at the end of the request, to prevent file system exhaustion. Because of this, you must copy (or move) the file somewhere else before the end of the request if you want to keep it fo a later usage.
</div>
</div>
<div class="section">
<h3><a name="Configure_the_file_provider_to_use"></a>Configure the file provider to use</h3>
<p>Ninja let&#x2019;s you configure the file provider to use at different places: - in a module, using a bind to configure a default provider - in a controller class, to override the default&#x2019;s provider configured in the module - in a controller method, to override the class or module provider</p>
<p>By default, the provider is set to <tt>NoFileItemProvider</tt>, who simply reverts to the manual way of handling file.</p>
<p>To define a provider in a module, simply use a bind:</p>

<div>
<pre class="prettyprint">
bind(FileItemProvider.class).to(MemoryFileItemProvider.class)
</pre></div>

<p>To define a provider in a controller class and/or method, use an annotation:</p>

<div>
<pre class="prettyprint">
@FileProvider(DiskFileItemProvider.class)
@Singleton
public class MyController {
    @FileProvider(MemoryFileItemProvider.class)
    public Result myRouteMethod() {
        // This will use the MemoryFileItemProvider defined at method level
    }
    public Result myOtherRouteMethod() {
        // This will use the DiskFileItemProvider defined at class level
    }
}
</pre></div>
</div></div>
<div class="section">
<h2><a name="Advanced_usage"></a>Advanced usage</h2>
<p>Ninja uses Apache Commons-upload to implement the upload functionality. Therefore you can also refer to their excellent manual for more information at: <a class="externalLink" href="http://commons.apache.org/proper/commons-fileupload/">http://commons.apache.org/proper/commons-fileupload/</a></p></div>
        </div>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>Copyright &copy;2019
<a href="http://www.ninjaframework.org">ninjaframework</a>.
All rights reserved.</p>
        </div>
      </div>
    </footer>
  </body>
</html>
