<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at 2015-07-01 
 | Rendered using Apache Maven Fluido Skin 1.3.1
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20150701" />
    <meta http-equiv="Content-Language" content="en" />
    <title>Ninja - full stack web framework for Java - </title>
    <link rel="stylesheet" href="../../css/apache-maven-fluido-1.3.1.min.css" />
    <link rel="stylesheet" href="../../css/site.css" />
    <link rel="stylesheet" href="../../css/print.css" media="print" />

      
    <script type="text/javascript" src="../../js/apache-maven-fluido-1.3.1.min.js"></script>

                          
        
<meta name="description" content="Ninja is a full stack web framework for Java.                     Rock solid, fast and super productive."/>
                      
        
<link rel="icon" href="favicon.png" type="image/png"/>
                      
        
<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Titillium+Web" type="text/css"/>
                      
        
<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Inconsolata" type="text/css"/>
                      
        
<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" type="text/css"/>
                      
        
<script type="text/javascript">var _gaq = _gaq || [];
                _gaq.push(['_setAccount', 'UA-38154034-1']);
                _gaq.push(['_trackPageview']);

                (function() {
                var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
                })();</script>
          
                  </head>
        <body class="topBarDisabled">
          
    
    
            
    
        
    <a href="http://github.com/ninjaframework/ninja">
      <img style="position: absolute; top: 0; right: 0; border: 0; z-index: 10000;"
        src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png"
        alt="Fork me on GitHub">
    </a>
  
                
                    
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                                  <a href="../../.." id="bannerLeft" title="Ninja web framework">
                                                                                                <img src="../../ninja_logo.png"  alt="Ninja web framework"/>
                </a>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
                    
            
                
                    
                  <li id="publishDate" class="pull-right"><span class="divider">|</span> Last Published: 2015-07-01</li>
              <li id="projectVersion" class="pull-right">
                    Version: 5.1.4
        </li>
            
                            </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
                
                    
                <ul class="nav nav-list">
                    <li class="nav-header">Introduction</li>
                              
      <li>
  
                          <a href="../../introduction.html" title="The problem we solve">
          <i class="none"></i>
        The problem we solve</a>
            </li>
                
      <li>
  
                          <a href="../../high_level_overview.html" title="Ninja - high level overview">
          <i class="none"></i>
        Ninja - high level overview</a>
            </li>
                
      <li>
  
                          <a href="../../team.html" title="The team">
          <i class="none"></i>
        The team</a>
            </li>
                              <li class="nav-header">Commercial support</li>
                              
      <li>
  
                          <a href="../../commercial_support/philosophy.html" title="Philosophy">
          <i class="none"></i>
        Philosophy</a>
            </li>
                
      <li>
  
                          <a href="../../commercial_support/training.html" title="Training">
          <i class="none"></i>
        Training</a>
            </li>
                
      <li>
  
                          <a href="../../commercial_support/support_plans.html" title="Support plans">
          <i class="none"></i>
        Support plans</a>
            </li>
                
      <li>
  
                          <a href="../../commercial_support/agile_custom_development.html" title="Custom development">
          <i class="none"></i>
        Custom development</a>
            </li>
                              <li class="nav-header">Documentation</li>
                                                                                                                    
      <li>
  
                          <a href="../../documentation/getting_started/installing_ninja.html" title="Getting Started">
          <i class="icon-chevron-right"></i>
        Getting Started</a>
                  </li>
                                                                                                                                                                                                                                    
      <li>
  
                          <a href="../../documentation/basic_concepts/basic_concepts.html" title="Basic concepts">
          <i class="icon-chevron-right"></i>
        Basic concepts</a>
                  </li>
                
      <li>
  
                          <a href="../../documentation/configuration_and_modes.html" title="Configuration and modes">
          <i class="none"></i>
        Configuration and modes</a>
            </li>
                                                                                                      
      <li>
  
                          <a href="../../documentation/html_templating/getting_started.html" title="Html templating">
          <i class="icon-chevron-right"></i>
        Html templating</a>
                  </li>
                
      <li>
  
                          <a href="../../documentation/working_with_json_jsonp.html" title="Working with Json / JsonP">
          <i class="none"></i>
        Working with Json / JsonP</a>
            </li>
                
      <li>
  
                          <a href="../../documentation/working_with_xml.html" title="Working with Xml">
          <i class="none"></i>
        Working with Xml</a>
            </li>
                              <li class="nav-header">Advanced topics</li>
                              
      <li>
  
                          <a href="../../documentation/validation.html" title="Validation">
          <i class="none"></i>
        Validation</a>
            </li>
                
      <li>
  
                          <a href="../../documentation/content_negotiation.html" title="Content negotiation">
          <i class="none"></i>
        Content negotiation</a>
            </li>
                
      <li>
  
                          <a href="../../documentation/uploading_files.html" title="Uploading files">
          <i class="none"></i>
        Uploading files</a>
            </li>
                
      <li>
  
                          <a href="../../documentation/scheduler.html" title="Scheduler">
          <i class="none"></i>
        Scheduler</a>
            </li>
                
      <li>
  
                          <a href="../../documentation/lifecycle.html" title="Lifecycle">
          <i class="none"></i>
        Lifecycle</a>
            </li>
                                                                            
      <li>
  
                          <a href="../../documentation/working_with_relational_dbs/jpa.html" title="Working with relational DBs">
          <i class="icon-chevron-down"></i>
        Working with relational DBs</a>
                    <ul class="nav nav-list">
                    
      <li class="active">
  
            <a href="#"><i class="none"></i>DB Migrations</a>
          </li>
              </ul>
        </li>
                
      <li>
  
                          <a href="../../documentation/using_the_cache.html" title="Using the cache">
          <i class="none"></i>
        Using the cache</a>
            </li>
                
      <li>
  
                          <a href="../../documentation/internationalization.html" title="Internationalization">
          <i class="none"></i>
        Internationalization</a>
            </li>
                
      <li>
  
                          <a href="../../documentation/static_assets.html" title="Static assets">
          <i class="none"></i>
        Static assets</a>
            </li>
                
      <li>
  
                          <a href="../../documentation/sending_mail.html" title="Sending mail">
          <i class="none"></i>
        Sending mail</a>
            </li>
                
      <li>
  
                          <a href="../../documentation/logging.html" title="Logging">
          <i class="none"></i>
        Logging</a>
            </li>
                
      <li>
  
                          <a href="../../documentation/custom_routing.html" title="Custom routing">
          <i class="none"></i>
        Custom routing</a>
            </li>
                
      <li>
  
                          <a href="../../documentation/servlet_bridge.html" title="Servlet bridge">
          <i class="none"></i>
        Servlet bridge</a>
            </li>
                                                                                                                                          
      <li>
  
                          <a href="../../documentation/testing_your_application/getting_started.html" title="Testing">
          <i class="icon-chevron-right"></i>
        Testing</a>
                  </li>
                
      <li>
  
                          <a href="../../documentation/debugging.html" title="Debugging">
          <i class="none"></i>
        Debugging</a>
            </li>
                
      <li>
  
                          <a href="../../documentation/security/getting_started.html" title="Security">
          <i class="none"></i>
        Security</a>
            </li>
                                                                                                                        
      <li>
  
                          <a href="../../documentation/deployment/getting_started.html" title="Deployment">
          <i class="icon-chevron-right"></i>
        Deployment</a>
                  </li>
                
      <li>
  
                          <a href="../../documentation/upgrade_guide.html" title="Upgrade guide">
          <i class="none"></i>
        Upgrade guide</a>
            </li>
                
      <li>
  
                          <a href="../../apidocs/index.html" title="Api">
          <i class="none"></i>
        Api</a>
            </li>
                              <li class="nav-header">Ninja Modules</li>
                              
      <li>
  
                          <a href="../../documentation/modules.html" title="Overview">
          <i class="none"></i>
        Overview</a>
            </li>
                              <li class="nav-header">Great community</li>
                              
      <li>
  
                          <a href="https://twitter.com/ninjaframework" class="externalLink" title="@ninjaframework">
          <i class="none"></i>
        @ninjaframework</a>
            </li>
                
      <li>
  
                          <a href="https://groups.google.com/d/forum/ninja-framework" class="externalLink" title="Mailing list">
          <i class="none"></i>
        Mailing list</a>
            </li>
                
      <li>
  
                          <a href="https://github.com/ninjaframework/ninja" class="externalLink" title="Source code">
          <i class="none"></i>
        Source code</a>
            </li>
                
      <li>
  
                          <a href="https://github.com/ninjaframework/ninja/issues" class="externalLink" title="Bug tracker">
          <i class="none"></i>
        Bug tracker</a>
            </li>
                
      <li>
  
                          <a href="../../security.html" title="Security issues">
          <i class="none"></i>
        Security issues</a>
            </li>
                              <li class="nav-header">For developers</li>
                              
      <li>
  
                          <a href="../../developer/changelog.html" title="Changelog">
          <i class="none"></i>
        Changelog</a>
            </li>
                
      <li>
  
                          <a href="../../developer/roadmap.html" title="Roadmap">
          <i class="none"></i>
        Roadmap</a>
            </li>
                
      <li>
  
                          <a href="../../developer/getting_started.html" title="How to contribute">
          <i class="none"></i>
        How to contribute</a>
            </li>
            </ul>
                
                    
                            <form id="search-form" action="http://www.google.com/search" method="get" >
    
  <input value="http://www.ninjaframework.org" name="sitesearch" type="hidden"/>
  <input class="search-query" name="q" id="query" type="text" />
</form>
<script type="text/javascript" src="http://www.google.com/coop/cse/brand?form=search-form"></script>
          
          <hr />

           <div id="poweredBy">
                   
    <script type="text/javascript" src="https://apis.google.com/js/plusone.js"></script>

    
    <div class="g-plusone" data-href="http://www.ninjaframework.org/ninja-core" data-size="tall" ></div>

                   <div class="clear"></div>
                            <div class="clear"></div>
               
        
        
        <div id="twitter">
    
    <a href="https://twitter.com/ninjaframework" class="twitter-follow-button" data-show-count="true" data-align="left" data-size="medium" data-show-screen-name="true" data-lang="en">Follow ninjaframework</a>
    <script type="text/javascript">!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>

        </div>
                   <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="../../images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span9" >
                                  
            <h1>Database Migrations</h1><p>When you are using relational databases you need to track and organize schema evolutions.</p><p>This becomes increasingly important when many people are collaborating on one code base and also
when you want to consistently upgrade your production database.</p><p>To that end Ninja integrates the excellent Flyway migration tool (<a href="http://flywaydb.org/)">http://flywaydb.org/)</a>.</p><h1>Configuring migrations in Ninja</h1><p>Activate migrations by setting the following property:</p>
<pre class="prettyprint">
ninja.migration.run=true
</pre><p>Then set the credentials for your database:</p>
<pre class="prettyprint">
db.connection.url=jdbc:postgresql://localhost:5432/ra
db.connection.username=ra
db.connection.password=
</pre><h1>Setting up Flyway</h1><p>Flyway itself manages database migration scripts in a directory called db/migration. You should use
the following naming convention: <code>V1__.sql</code> is your first script, <code>V2__.sql</code>
is your second script and so on.</p><p>V1__.sql may look like:</p>
<pre class="prettyprint">
-- Just a simple table
create table GuestbookEntry (
    id int8 not null,
    email varchar(255),
    text varchar(255),
    primary key (id)
);

--needed for hibernate running on postgresql
create sequence hibernate_sequence;

</pre><p>A migration script is just plain old SQL. It is really important to stress that Flyway&rsquo;s migration
scripts are NOT database vendor independent. </p><p>Therefore it strongly discouraged to use different databases in test, dev and prod.</p><h1>Collaboratively working on migrations</h1><p>When two or more developers are working on the same script (let&rsquo;s say V2__.sql) they&rsquo;ll get
conflicts once they are trying to merge their changes.</p><p>But this is intentional and allows to fix problems in V2__.sql.
After resolving the issues and running your tests you can be confident
that your production upgrade will also work fine.</p><h1>Migrations in test, dev and prod</h1><p>In test mode Ninja automatically drop the schema and runs all migrations from scratch. In dev and production
migration scripts are executed automatically when they are detected. Usually this happens when the
first deployed Ninja instance connects with your database. Flyway&rsquo;s migrations are &ldquo;clustersafe&rdquo;. Therefore
nothing will go wrong when you are deploying 20 instances of your application that try to run the evolutions at
the same time.</p><h1>Flyway migrations versus Hibernate DDL</h1><p>Hibernate - the JPA implementation we are using is already providing a DDL (hbm2ddl) feature
that can manage and create &ldquo;migrations&rdquo; for you. </p><p>But Hibernate&rsquo;s hbm2ddl is &ldquo;just&rdquo; a diff tool.
Once your setup gets more complex Hibernate&rsquo;s feature is not enough.
Even the creators of Hibernate strongly discourage the usage in production systems:</p><p><strong>WARNING: We&rsquo;ve seen Hibernate users trying to use SchemaUpdate
to update the schema of a production database automatically.
This can quickly end in disaster and won&rsquo;t be allowed by your DBA.
(From the book Java Persistence with Hibernate).</strong></p><p>Our recommendation is to enable Hibernate&rsquo;s DDL for your first initial developments.</p><p>Enable that by setting the following properties inside your persistence unit (persistence.xml):</p>
<pre class="prettyprint">
&lt;property name=&quot;hibernate.hbm2ddl.auto&quot; value=&quot;create&quot; /&gt; 
&lt;property name=&quot;hibernate.show_sql&quot; value=&quot;true&quot; /&gt;
&lt;property name=&quot;hibernate.format_sql&quot; value=&quot;true&quot; /&gt;
</pre><p>Hint: Try using <strong>create</strong> (always drops data in your db) or <strong>update</strong> (tries to alter existing tables for
new data) for hibernate.hbm2ddl.auto.</p><p>Hibernate will then print out nice SQL statements for the creation of your tables, sequences and so on. </p><p>Once your initial prototype is ready copy them to your first migration (eg V1__.sql)
and deactivate Hibernate&rsquo;s DDL feature. From now on use Ninja&rsquo;s migrations and everything is safe.</p><h1>More</h1><p>Flyway offers a lot more. For instance Java based migrations, that really facilitate refactoring
of blobs. Check out Flyway&rsquo;s excellent site at: <a href="http://flywaydb.org">http://flywaydb.org</a></p>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
                      <div class="row-fluid">
                              <p >Copyright &copy;                    2015
                        <a href="http://www.ninjaframework.org">ninjaframework</a>.
            All rights reserved.      
                    
      </p>
        </div>

        
        
                </div>
    </footer>
        </body>
</html>
